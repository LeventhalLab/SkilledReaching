function [meanTrajectory, varTrajectory, numValidTraj] = calcAverageTrajectory(x,y,z,varargin)

slot_z = 175;

for iarg = 1 : 2 : nargin - 3
    switch lower(varargin{iarg})
        case 'slot_z',
            slot_z = varargin{iarg + 1};
    end
end

slotCrossFrames = DKL_slotCrossFrames(z, 'slot_z', slot_z);
aligned_trajectories = alignTrajectoriesToFrame(x,y,z,slotCrossFrames);
% now align x,y,z to the cross frame for each trajectory. If no cross frame
% identified, skip

aligned_trajectories(aligned_trajectories==0) = NaN;
    
% count up how many valid trajectory points there are at each virtual frame
numValidTraj
for i_frame = 1 : size(aligned_trajectories,1)
    
meanTrajectory = nanmean(aligned_trajectories,3);
varTrajectory = nanvar(aligned_trajectories, 0, 3);